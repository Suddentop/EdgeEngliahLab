# 배포를 위한 빌드 가이드

## 📋 개요

이 문서는 **정적 사이트 환경** (https://edgeenglish.net/)에 배포하기 위한 React 애플리케이션 빌드 과정을 상세히 설명합니다.

## 🎯 배포 환경

- **배포 대상**: 정적 사이트 (https://edgeenglish.net/)
- **호스팅 방식**: 정적 파일 호스팅 (CDN, 웹 서버 등)
- **제약사항**: 서버 사이드 기능 없음, 클라이언트 사이드에서만 작동
- **콘솔 로그**: 프로덕션 환경에서 자동 비활성화

## 🔧 빌드 전 준비사항

### 1. 환경 변수 설정

정적 사이트에서는 모든 설정이 빌드 시점에 번들에 포함되어야 합니다.

#### 필수 환경 변수

```bash
# OpenAI API 키 (AI 기능용)
REACT_APP_OPENAI_API_KEY=sk-proj-your-actual-api-key-here

# Firebase 설정
REACT_APP_FIREBASE_API_KEY=AIzaSyDQJynQZGn3TomGEMtZYSGQrYlvO7CApNo
REACT_APP_FIREBASE_AUTH_DOMAIN=edgeenglishlab.firebaseapp.com
REACT_APP_FIREBASE_PROJECT_ID=edgeenglishlab
REACT_APP_FIREBASE_STORAGE_BUCKET=edgeenglishlab.firebasestorage.app
REACT_APP_FIREBASE_MESSAGING_SENDER_ID=13831715924
REACT_APP_FIREBASE_APP_ID=1:13831715924:web:41907bce49707865e981c1
```

#### 환경 변수 설정 방법

**방법 1: PowerShell에서 직접 설정**
```powershell
# 환경 변수 설정
$env:REACT_APP_OPENAI_API_KEY="sk-proj-your-actual-api-key-here"
$env:REACT_APP_FIREBASE_API_KEY="AIzaSyDQJynQZGn3TomGEMtZYSGQrYlvO7CApNo"
$env:REACT_APP_FIREBASE_AUTH_DOMAIN="edgeenglishlab.firebaseapp.com"
$env:REACT_APP_FIREBASE_PROJECT_ID="edgeenglishlab"
$env:REACT_APP_FIREBASE_STORAGE_BUCKET="edgeenglishlab.firebasestorage.app"
$env:REACT_APP_FIREBASE_MESSAGING_SENDER_ID="13831715924"
$env:REACT_APP_FIREBASE_APP_ID="1:13831715924:web:41907bce49707865e981c1"

# 빌드 실행
npm run build
```

**방법 2: .env.local 파일 생성**
```bash
# .env.local 파일 생성
echo "REACT_APP_OPENAI_API_KEY=sk-proj-your-actual-api-key-here" > .env.local
echo "REACT_APP_FIREBASE_API_KEY=AIzaSyDQJynQZGn3TomGEMtZYSGQrYlvO7CApNo" >> .env.local
echo "REACT_APP_FIREBASE_AUTH_DOMAIN=edgeenglishlab.firebaseapp.com" >> .env.local
echo "REACT_APP_FIREBASE_PROJECT_ID=edgeenglishlab" >> .env.local
echo "REACT_APP_FIREBASE_STORAGE_BUCKET=edgeenglishlab.firebasestorage.app" >> .env.local
echo "REACT_APP_FIREBASE_MESSAGING_SENDER_ID=13831715924" >> .env.local
echo "REACT_APP_FIREBASE_APP_ID=1:13831715924:web:41907bce49707865e981c1" >> .env.local

# 빌드 실행
npm run build
```

### 2. 콘솔 로그 비활성화 설정

프로덕션 환경에서 콘솔 로그를 자동으로 비활성화하는 설정이 포함되어 있습니다.

#### 자동 콘솔 로그 비활성화

`src/utils/disableConsole.js` 파일이 자동으로 생성되어 프로덕션 환경에서 모든 콘솔 메서드를 비활성화합니다:

```javascript
// 프로덕션 환경에서 콘솔 로그 비활성화
if (process.env.NODE_ENV === 'production') {
  console.log = () => {};
  console.warn = () => {};
  console.error = () => {};
  console.info = () => {};
  console.debug = () => {};
  // ... 기타 모든 콘솔 메서드들
}
```

#### App.tsx에 자동 로드

`src/App.tsx`에서 자동으로 로드되어 프로덕션 빌드 시 콘솔 로그가 비활성화됩니다:

```javascript
// 프로덕션 환경에서 콘솔 로그 비활성화
import './utils/disableConsole';
```

### 3. 기존 빌드 정리

```bash
# 기존 빌드 폴더 삭제
if (Test-Path build) { Remove-Item -Recurse -Force build }

# 또는 Windows 명령어
rmdir /s /q build
```

## 🚀 빌드 실행

### 1. 기본 빌드 명령어

```bash
npm run build
```

### 2. 빌드 과정

1. **의존성 확인**: package.json의 모든 의존성 확인
2. **TypeScript 컴파일**: .tsx, .ts 파일을 JavaScript로 변환
3. **콘솔 로그 비활성화**: 프로덕션 환경에서 자동으로 콘솔 로그 비활성화
4. **번들링**: 모든 파일을 하나의 JS 파일로 번들링
5. **최적화**: 코드 압축 및 최적화
6. **정적 파일 복사**: public 폴더의 파일들을 build 폴더로 복사

### 3. 빌드 결과 확인

```bash
# 빌드 폴더 구조 확인
dir build

# 빌드된 파일 크기 확인
dir build\static\js
dir build\static\css
```

**예상 빌드 결과:**
```
build/
├── index.html              (934 bytes)
├── favicon.ico             (458KB)
├── logo.png               (458KB)
├── howtowork.png          (2.68MB)
├── asset-manifest.json    (369 bytes)
└── static/
    ├── css/
    │   ├── main.xxxxx.css (35.53KB)
    │   └── main.xxxxx.css.map
    └── js/
        ├── main.xxxxx.js (354.26KB gzip)
        ├── main.xxxxx.js.LICENSE.txt
        └── main.xxxxx.js.map
```

**실제 빌드 결과 (2025-09-28 기준):**
- **JavaScript 번들**: 354.26 kB (gzip 압축)
- **CSS 파일**: 35.53 kB (gzip 압축)
- **콘솔 로그**: 프로덕션 환경에서 자동 비활성화

## 🔍 빌드 검증

### 1. API 키 포함 확인

```bash
# 빌드된 JS 파일에서 API 키 확인
findstr /i "openai" build\static\js\main.*.js
```

**예상 결과**: API 키가 포함되어 있어야 함

### 2. Firebase 설정 확인

```bash
# Firebase 설정 확인
findstr /i "firebase" build\static\js\main.*.js
```

### 3. 콘솔 로그 비활성화 확인

```bash
# 빌드된 JS 파일에서 콘솔 로그 확인
findstr /i "console\.log" build\static\js\main.*.js
```

**예상 결과**: 콘솔 로그가 비활성화되어 있어야 함 (빈 결과 또는 최소한의 로그만 남음)

### 4. 빌드 오류 확인

빌드 과정에서 다음과 같은 경고가 나타날 수 있지만 정상입니다:

- **ESLint 경고**: 사용하지 않는 변수, 함수 등
- **CSS 최적화 경고**: SVG 파싱 관련 경고
- **TypeScript 경고**: 타입 관련 경고

**중요**: 빌드가 성공적으로 완료되면 경고는 무시해도 됩니다.

## 📦 배포 준비

### 1. 배포 파일 확인

배포 전 다음 파일들이 모두 포함되어 있는지 확인:

- ✅ `index.html` - 메인 HTML 파일
- ✅ `static/js/main.*.js` - 메인 JavaScript 번들
- ✅ `static/css/main.*.css` - 메인 CSS 파일
- ✅ `favicon.ico` - 파비콘
- ✅ `logo.png` - 로고 이미지
- ✅ `howtowork.png` - 도움말 이미지

### 2. 파일 크기 최적화

**정상적인 파일 크기:**
- **JS 번들**: 1.5MB 이하 (gzip: 350KB 이하) ✅ **실제: 354.26KB**
- **CSS 파일**: 40KB 이하 (gzip: 35KB 이하) ✅ **실제: 35.53KB**
- **이미지 파일**: 필요에 따라 최적화
- **콘솔 로그**: 프로덕션 환경에서 자동 비활성화 ✅

## 🌐 배포 방법

### 1. FTP/SFTP 업로드

```bash
# build 폴더의 모든 내용을 웹 서버 루트에 업로드
# 예: /public_html/ 또는 /www/ 폴더
```

### 2. 웹 호스팅 패널 업로드

1. 호스팅 패널의 파일 매니저 접속
2. `build/` 폴더의 모든 파일을 웹 루트에 업로드
3. 파일 권한 설정 (755 또는 644)

### 3. CDN 배포

1. CDN 서비스에 `build/` 폴더 업로드
2. 도메인 설정을 https://edgeenglish.net/로 연결
3. 캐시 설정 최적화

## 🔧 배포 후 확인사항

### 1. 기본 기능 테스트

- [ ] 홈페이지 로딩 확인
- [ ] 로그인/회원가입 기능 확인
- [ ] 네비게이션 메뉴 작동 확인

### 2. AI 기능 테스트

- [ ] 캡처 이미지 붙여넣기 테스트
- [ ] 영어 본문 직접 붙여넣기 테스트
- [ ] 문제 생성 기능 확인
- [ ] 콘솔에서 401 오류 없음 확인
- [ ] 개발자 콘솔에서 로그 메시지가 나오지 않는지 확인

### 3. 인쇄 기능 테스트

- [ ] 각 유형별 문제 생성 후 인쇄 미리보기 확인
- [ ] 페이지 분할 로직 정상 작동 확인
- [ ] A4 템플릿 정상 렌더링 확인

## ⚠️ 주의사항

### 1. 보안 고려사항

**정적 사이트의 한계:**
- API 키가 클라이언트에 노출됨
- 브라우저 개발자 도구에서 API 키 확인 가능
- 이는 정적 사이트 환경의 불가피한 제약사항

**권장사항:**
- API 키 사용량 모니터링
- 정기적인 API 키 교체
- 사용량 제한 설정

### 2. 콘솔 로그 비활성화

**자동 비활성화:**
- 프로덕션 빌드에서 모든 콘솔 메서드가 자동으로 비활성화됨
- `console.log()`, `console.warn()`, `console.error()` 등 모든 메서드 비활성화
- 개발자 도구에서 로그 메시지가 표시되지 않음

**개발 환경:**
- 개발 모드(`npm start`)에서는 콘솔 로그가 정상 작동
- 프로덕션 빌드(`npm run build`)에서만 비활성화

### 3. 성능 최적화

- **이미지 최적화**: 필요시 이미지 압축
- **CDN 사용**: 정적 파일 전송 속도 향상
- **캐시 설정**: 브라우저 캐시 최적화
- **콘솔 로그 제거**: 프로덕션 환경에서 자동으로 콘솔 로그 제거

### 4. 업데이트 시 주의사항

- **API 키 변경**: 환경 변수 업데이트 후 재빌드 필요
- **코드 변경**: 소스 코드 수정 후 재빌드 및 재배포 필요
- **의존성 업데이트**: package.json 변경 시 재빌드 필요
- **콘솔 로그 설정**: `src/utils/disableConsole.js` 파일 수정 시 재빌드 필요

## 🚨 문제 해결

### 1. 빌드 실패 시

```bash
# 의존성 재설치
npm install

# 캐시 정리
npm start -- --reset-cache

# node_modules 삭제 후 재설치
rmdir /s /q node_modules
npm install
```

### 2. API 키 오류 시

```bash
# 환경 변수 확인
echo $env:REACT_APP_OPENAI_API_KEY

# 환경 변수 재설정 후 빌드
$env:REACT_APP_OPENAI_API_KEY="your-api-key-here"
npm run build
```

### 3. 콘솔 로그가 여전히 표시되는 경우

```bash
# disableConsole.js 파일이 올바르게 생성되었는지 확인
dir src\utils\disableConsole.js

# App.tsx에서 import가 올바른지 확인
findstr /i "disableConsole" src\App.tsx
```

**해결 방법:**
- `src/utils/disableConsole.js` 파일이 존재하는지 확인
- `src/App.tsx`에서 `import './utils/disableConsole';`가 포함되어 있는지 확인
- 프로덕션 빌드(`npm run build`)를 다시 실행

### 4. 배포 후 404 오류 시

- **라우팅 설정**: SPA 라우팅을 위한 서버 설정 확인
- **파일 경로**: 모든 파일이 올바른 경로에 업로드되었는지 확인
- **권한 설정**: 파일 읽기 권한 확인

## 📝 체크리스트

### 빌드 전
- [ ] 환경 변수 설정 완료
- [ ] 기존 빌드 폴더 정리
- [ ] 의존성 설치 완료
- [ ] 콘솔 로그 비활성화 설정 확인

### 빌드 중
- [ ] 빌드 성공 확인
- [ ] 경고 메시지 검토
- [ ] 파일 크기 확인
- [ ] 콘솔 로그 비활성화 적용 확인

### 빌드 후
- [ ] API 키 포함 확인
- [ ] Firebase 설정 확인
- [ ] 콘솔 로그 비활성화 확인
- [ ] 모든 파일 존재 확인

### 배포 후
- [ ] 기본 기능 테스트
- [ ] AI 기능 테스트
- [ ] 인쇄 기능 테스트
- [ ] 개발자 콘솔에서 로그 메시지가 나오지 않는지 확인
- [ ] 오류 로그 확인

## 📞 지원

빌드 또는 배포 과정에서 문제가 발생하면:

1. **콘솔 오류 확인**: 브라우저 개발자 도구에서 오류 메시지 확인
2. **로그 분석**: 빌드 과정의 경고 및 오류 메시지 분석
3. **환경 변수 재확인**: 모든 환경 변수가 올바르게 설정되었는지 확인
4. **콘솔 로그 설정 확인**: `src/utils/disableConsole.js` 파일과 `src/App.tsx` import 확인

## 🆕 최신 업데이트 (2025-09-28)

### 추가된 기능
- ✅ **콘솔 로그 자동 비활성화**: 프로덕션 환경에서 모든 콘솔 메서드 자동 비활성화
- ✅ **런타임 콘솔 제거**: `src/utils/disableConsole.js`를 통한 런타임 콘솔 로그 제거
- ✅ **자동 로드**: `src/App.tsx`에서 자동으로 콘솔 비활성화 모듈 로드

### 빌드 결과
- **JavaScript 번들**: 354.26 kB (gzip 압축)
- **CSS 파일**: 35.53 kB (gzip 압축)
- **콘솔 로그**: 프로덕션 환경에서 완전 비활성화

---

**마지막 업데이트**: 2025-09-28
**문서 버전**: 2.0
**적용 환경**: 정적 사이트 (https://edgeenglish.net/)
**주요 기능**: 콘솔 로그 자동 비활성화
