# 📊 dothome.co.kr 백엔드 서버 모니터링 및 관리 가이드

## 📋 개요

dothome.co.kr PHP 백엔드 서버의 성능, 보안, 사용량을 효과적으로 모니터링하고 관리하는 방법을 상세히 설명합니다.

## 🎯 모니터링 목표

### 핵심 지표 (KPI)
- **가용성**: 99.9% 이상
- **응답 시간**: 평균 5초 이내
- **성공률**: 99% 이상
- **에러율**: 1% 이하
- **보안 사고**: 0건

### 모니터링 범위
- ✅ **성능 모니터링**: 응답 시간, 처리량, 리소스 사용량
- ✅ **보안 모니터링**: 침입 탐지, 비정상 접근, 보안 이벤트
- ✅ **사용량 모니터링**: API 호출 수, 사용자 활동, 트래픽 패턴
- ✅ **시스템 모니터링**: 서버 상태, 디스크 사용량, 메모리 사용량

## 📈 1단계: 실시간 로그 모니터링

### 1.1 기본 로그 모니터링
```bash
# 실시간 로그 확인
tail -f api_logs.txt

# 에러만 필터링
tail -f api_logs.txt | grep "ERROR"

# 특정 시간대 로그 확인
grep "2024-01-15" api_logs.txt

# 요청 제한 관련 로그
grep "Rate limit" api_logs.txt
```

### 1.2 로그 분석 스크립트
```php
<?php
// log_analyzer.php - 로그 분석 도구

class LogAnalyzer {
    private $logFile;
    
    public function __construct($logFile = 'api_logs.txt') {
        $this->logFile = $logFile;
    }
    
    public function getTodayStats() {
        $today = date('Y-m-d');
        $lines = file($this->logFile, FILE_IGNORE_NEW_LINES);
        
        $stats = [
            'total_requests' => 0,
            'successful_requests' => 0,
            'failed_requests' => 0,
            'rate_limit_exceeded' => 0,
            'avg_response_time' => 0
        ];
        
        $responseTimes = [];
        
        foreach ($lines as $line) {
            if (strpos($line, $today) === 0) {
                $stats['total_requests']++;
                
                if (strpos($line, 'ERROR') !== false) {
                    $stats['failed_requests']++;
                    
                    if (strpos($line, 'Rate limit') !== false) {
                        $stats['rate_limit_exceeded']++;
                    }
                } else {
                    $stats['successful_requests']++;
                }
                
                // 응답 시간 추출
                if (preg_match('/API call successful: ([\d.]+)s/', $line, $matches)) {
                    $responseTimes[] = floatval($matches[1]);
                }
            }
        }
        
        if (!empty($responseTimes)) {
            $stats['avg_response_time'] = array_sum($responseTimes) / count($responseTimes);
        }
        
        return $stats;
    }
    
    public function getTopIPs($limit = 10) {
        $today = date('Y-m-d');
        $lines = file($this->logFile, FILE_IGNORE_NEW_LINES);
        
        $ipCounts = [];
        
        foreach ($lines as $line) {
            if (strpos($line, $today) === 0 && preg_match('/\[(\d+\.\d+\.\d+\.\d+)\]/', $line, $matches)) {
                $ip = $matches[1];
                $ipCounts[$ip] = ($ipCounts[$ip] ?? 0) + 1;
            }
        }
        
        arsort($ipCounts);
        return array_slice($ipCounts, 0, $limit, true);
    }
    
    public function getErrorPatterns() {
        $today = date('Y-m-d');
        $lines = file($this->logFile, FILE_IGNORE_NEW_LINES);
        
        $errorPatterns = [];
        
        foreach ($lines as $line) {
            if (strpos($line, $today) === 0 && strpos($line, 'ERROR') !== false) {
                if (preg_match('/ERROR\] (.*)/', $line, $matches)) {
                    $error = $matches[1];
                    $errorPatterns[$error] = ($errorPatterns[$error] ?? 0) + 1;
                }
            }
        }
        
        arsort($errorPatterns);
        return $errorPatterns;
    }
}

// 사용 예시
$analyzer = new LogAnalyzer();
$todayStats = $analyzer->getTodayStats();
$topIPs = $analyzer->getTopIPs();
$errorPatterns = $analyzer->getErrorPatterns();

echo "=== 오늘 통계 ===\n";
echo "총 요청 수: {$todayStats['total_requests']}\n";
echo "성공 요청: {$todayStats['successful_requests']}\n";
echo "실패 요청: {$todayStats['failed_requests']}\n";
echo "평균 응답 시간: {$todayStats['avg_response_time']}초\n";
echo "요청 제한 초과: {$todayStats['rate_limit_exceeded']}\n";
?>
```

### 1.3 로그 대시보드
```php
<?php
// dashboard.php - 실시간 모니터링 대시보드

class MonitoringDashboard {
    private $logAnalyzer;
    
    public function __construct() {
        $this->logAnalyzer = new LogAnalyzer();
    }
    
    public function generateDashboard() {
        $stats = $this->logAnalyzer->getTodayStats();
        $topIPs = $this->logAnalyzer->getTopIPs();
        $errorPatterns = $this->logAnalyzer->getErrorPatterns();
        
        $html = $this->generateHTML($stats, $topIPs, $errorPatterns);
        
        file_put_contents('dashboard.html', $html);
        
        return $html;
    }
    
    private function generateHTML($stats, $topIPs, $errorPatterns) {
        $successRate = $stats['total_requests'] > 0 ? 
            round(($stats['successful_requests'] / $stats['total_requests']) * 100, 2) : 0;
            
        return "
        <!DOCTYPE html>
        <html>
        <head>
            <title>API 서버 모니터링 대시보드</title>
            <meta http-equiv='refresh' content='30'>
            <style>
                body { font-family: Arial, sans-serif; margin: 20px; }
                .stats { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; }
                .stat-card { background: #f5f5f5; padding: 20px; border-radius: 8px; text-align: center; }
                .stat-value { font-size: 2em; font-weight: bold; color: #333; }
                .stat-label { color: #666; margin-top: 10px; }
                .success { color: #28a745; }
                .error { color: #dc3545; }
                .warning { color: #ffc107; }
                table { width: 100%; border-collapse: collapse; margin-top: 20px; }
                th, td { padding: 10px; text-align: left; border-bottom: 1px solid #ddd; }
                th { background-color: #f2f2f2; }
            </style>
        </head>
        <body>
            <h1>🚀 API 서버 모니터링 대시보드</h1>
            <p>마지막 업데이트: " . date('Y-m-d H:i:s') . "</p>
            
            <div class='stats'>
                <div class='stat-card'>
                    <div class='stat-value'>{$stats['total_requests']}</div>
                    <div class='stat-label'>총 요청 수</div>
                </div>
                <div class='stat-card'>
                    <div class='stat-value success'>{$stats['successful_requests']}</div>
                    <div class='stat-label'>성공 요청</div>
                </div>
                <div class='stat-card'>
                    <div class='stat-value error'>{$stats['failed_requests']}</div>
                    <div class='stat-label'>실패 요청</div>
                </div>
                <div class='stat-card'>
                    <div class='stat-value'>{$successRate}%</div>
                    <div class='stat-label'>성공률</div>
                </div>
                <div class='stat-card'>
                    <div class='stat-value'>{$stats['avg_response_time']}초</div>
                    <div class='stat-label'>평균 응답 시간</div>
                </div>
                <div class='stat-card'>
                    <div class='stat-value warning'>{$stats['rate_limit_exceeded']}</div>
                    <div class='stat-label'>요청 제한 초과</div>
                </div>
            </div>
            
            <h2>📊 상위 IP 주소</h2>
            <table>
                <tr><th>IP 주소</th><th>요청 수</th></tr>
        " . $this->generateTopIPsTable($topIPs) . "
            </table>
            
            <h2>⚠️ 에러 패턴</h2>
            <table>
                <tr><th>에러 메시지</th><th>발생 횟수</th></tr>
        " . $this->generateErrorPatternsTable($errorPatterns) . "
            </table>
        </body>
        </html>";
    }
    
    private function generateTopIPsTable($topIPs) {
        $html = '';
        foreach ($topIPs as $ip => $count) {
            $html .= "<tr><td>$ip</td><td>$count</td></tr>";
        }
        return $html;
    }
    
    private function generateErrorPatternsTable($errorPatterns) {
        $html = '';
        foreach ($errorPatterns as $error => $count) {
            $html .= "<tr><td>$error</td><td>$count</td></tr>";
        }
        return $html;
    }
}

// 대시보드 생성
$dashboard = new MonitoringDashboard();
$dashboard->generateDashboard();
echo "대시보드가 생성되었습니다: dashboard.html";
?>
```

## 📊 2단계: 성능 모니터링

### 2.1 성능 메트릭 수집
```php
class PerformanceMonitor {
    private $metrics = [];
    
    public function startTimer($operation) {
        $this->metrics[$operation] = [
            'start_time' => microtime(true),
            'memory_start' => memory_get_usage()
        ];
    }
    
    public function endTimer($operation) {
        if (!isset($this->metrics[$operation])) {
            return null;
        }
        
        $start = $this->metrics[$operation];
        $endTime = microtime(true);
        $endMemory = memory_get_usage();
        
        $result = [
            'operation' => $operation,
            'execution_time' => $endTime - $start['start_time'],
            'memory_usage' => $endMemory - $start['memory_start'],
            'peak_memory' => memory_get_peak_usage(),
            'timestamp' => date('Y-m-d H:i:s')
        ];
        
        $this->saveMetrics($result);
        
        return $result;
    }
    
    private function saveMetrics($metrics) {
        $logLine = json_encode($metrics) . "\n";
        file_put_contents('performance_logs.txt', $logLine, FILE_APPEND | LOCK_EX);
    }
    
    public function getPerformanceStats($hours = 24) {
        $lines = file('performance_logs.txt', FILE_IGNORE_NEW_LINES);
        $cutoff = time() - ($hours * 3600);
        
        $stats = [];
        
        foreach ($lines as $line) {
            $data = json_decode($line, true);
            if ($data && strtotime($data['timestamp']) > $cutoff) {
                $operation = $data['operation'];
                
                if (!isset($stats[$operation])) {
                    $stats[$operation] = [
                        'count' => 0,
                        'total_time' => 0,
                        'total_memory' => 0,
                        'max_time' => 0,
                        'max_memory' => 0
                    ];
                }
                
                $stats[$operation]['count']++;
                $stats[$operation]['total_time'] += $data['execution_time'];
                $stats[$operation]['total_memory'] += $data['memory_usage'];
                $stats[$operation]['max_time'] = max($stats[$operation]['max_time'], $data['execution_time']);
                $stats[$operation]['max_memory'] = max($stats[$operation]['max_memory'], $data['memory_usage']);
            }
        }
        
        // 평균 계산
        foreach ($stats as $operation => &$stat) {
            if ($stat['count'] > 0) {
                $stat['avg_time'] = $stat['total_time'] / $stat['count'];
                $stat['avg_memory'] = $stat['total_memory'] / $stat['count'];
            }
        }
        
        return $stats;
    }
}

// 사용 예시
$monitor = new PerformanceMonitor();

// API 호출 시간 측정
$monitor->startTimer('openai_api_call');
// ... API 호출 코드 ...
$result = $monitor->endTimer('openai_api_call');

echo "API 호출 시간: {$result['execution_time']}초\n";
echo "메모리 사용량: {$result['memory_usage']}바이트\n";
```

### 2.2 자동 성능 알림
```php
class PerformanceAlert {
    private $thresholds = [
        'response_time' => 10.0, // 10초
        'memory_usage' => 128 * 1024 * 1024, // 128MB
        'error_rate' => 0.05 // 5%
    ];
    
    public function checkPerformance($stats) {
        $alerts = [];
        
        foreach ($stats as $operation => $stat) {
            // 응답 시간 체크
            if ($stat['avg_time'] > $this->thresholds['response_time']) {
                $alerts[] = [
                    'type' => 'slow_response',
                    'operation' => $operation,
                    'value' => $stat['avg_time'],
                    'threshold' => $this->thresholds['response_time']
                ];
            }
            
            // 메모리 사용량 체크
            if ($stat['avg_memory'] > $this->thresholds['memory_usage']) {
                $alerts[] = [
                    'type' => 'high_memory',
                    'operation' => $operation,
                    'value' => $stat['avg_memory'],
                    'threshold' => $this->thresholds['memory_usage']
                ];
            }
        }
        
        if (!empty($alerts)) {
            $this->sendPerformanceAlert($alerts);
        }
        
        return $alerts;
    }
    
    private function sendPerformanceAlert($alerts) {
        $message = "성능 임계값 초과 알림:\n\n";
        
        foreach ($alerts as $alert) {
            $message .= "- {$alert['operation']}: {$alert['value']} > {$alert['threshold']}\n";
        }
        
        mail('admin@edgeenglish.net', '성능 알림', $message);
    }
}
```

## 🔒 3단계: 보안 모니터링

### 3.1 보안 이벤트 감지
```php
class SecurityMonitor {
    private $securityLogFile = 'security_logs.txt';
    private $suspiciousPatterns = [
        'sql_injection' => ['UNION', 'SELECT', 'DROP', 'INSERT', 'DELETE'],
        'xss_attempt' => ['<script', 'javascript:', 'onload='],
        'path_traversal' => ['../', '..\\', '/etc/passwd', 'windows/system32'],
        'command_injection' => [';', '|', '&', '`', '$(']
    ];
    
    public function analyzeRequest($request) {
        $riskScore = 0;
        $detectedThreats = [];
        
        $requestString = json_encode($request);
        
        foreach ($this->suspiciousPatterns as $threat => $patterns) {
            foreach ($patterns as $pattern) {
                if (stripos($requestString, $pattern) !== false) {
                    $riskScore += 10;
                    $detectedThreats[] = $threat;
                }
            }
        }
        
        if ($riskScore > 0) {
            $this->logSecurityEvent('suspicious_request', [
                'risk_score' => $riskScore,
                'threats' => $detectedThreats,
                'request' => $request,
                'ip' => $_SERVER['REMOTE_ADDR'] ?? 'unknown'
            ]);
        }
        
        return ['risk_score' => $riskScore, 'threats' => $detectedThreats];
    }
    
    private function logSecurityEvent($event, $details) {
        $logEntry = [
            'timestamp' => date('Y-m-d H:i:s'),
            'event' => $event,
            'details' => $details
        ];
        
        $logLine = json_encode($logEntry) . "\n";
        file_put_contents($this->securityLogFile, $logLine, FILE_APPEND | LOCK_EX);
        
        // 높은 위험도는 즉시 알림
        if ($details['risk_score'] > 50) {
            $this->sendSecurityAlert($event, $details);
        }
    }
    
    private function sendSecurityAlert($event, $details) {
        $message = "보안 경고: $event\n";
        $message .= "위험 점수: {$details['risk_score']}\n";
        $message .= "감지된 위협: " . implode(', ', $details['threats']) . "\n";
        $message .= "IP 주소: {$details['ip']}\n";
        
        mail('security@edgeenglish.net', '보안 경고', $message);
    }
    
    public function getSecurityStats($days = 7) {
        $lines = file($this->securityLogFile, FILE_IGNORE_NEW_LINES);
        $cutoff = time() - ($days * 24 * 3600);
        
        $stats = [
            'total_events' => 0,
            'high_risk_events' => 0,
            'threat_types' => [],
            'top_ips' => []
        ];
        
        foreach ($lines as $line) {
            $data = json_decode($line, true);
            if ($data && strtotime($data['timestamp']) > $cutoff) {
                $stats['total_events']++;
                
                $riskScore = $data['details']['risk_score'] ?? 0;
                if ($riskScore > 50) {
                    $stats['high_risk_events']++;
                }
                
                // 위협 유형별 카운트
                if (isset($data['details']['threats'])) {
                    foreach ($data['details']['threats'] as $threat) {
                        $stats['threat_types'][$threat] = ($stats['threat_types'][$threat] ?? 0) + 1;
                    }
                }
                
                // IP별 카운트
                $ip = $data['details']['ip'] ?? 'unknown';
                $stats['top_ips'][$ip] = ($stats['top_ips'][$ip] ?? 0) + 1;
            }
        }
        
        arsort($stats['threat_types']);
        arsort($stats['top_ips']);
        
        return $stats;
    }
}
```

### 3.2 실시간 보안 대시보드
```php
<?php
// security_dashboard.php - 보안 모니터링 대시보드

$securityMonitor = new SecurityMonitor();
$stats = $securityMonitor->getSecurityStats();

$html = "
<!DOCTYPE html>
<html>
<head>
    <title>보안 모니터링 대시보드</title>
    <meta http-equiv='refresh' content='60'>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .alert { background: #f8d7da; color: #721c24; padding: 15px; border-radius: 5px; margin: 10px 0; }
        .warning { background: #fff3cd; color: #856404; }
        .success { background: #d4edda; color: #155724; }
        .stats { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; }
        .stat-card { background: #f5f5f5; padding: 20px; border-radius: 8px; }
        .threat-level-high { color: #dc3545; font-weight: bold; }
        .threat-level-medium { color: #ffc107; font-weight: bold; }
        .threat-level-low { color: #28a745; }
    </style>
</head>
<body>
    <h1>🔒 보안 모니터링 대시보드</h1>
    <p>마지막 업데이트: " . date('Y-m-d H:i:s') . "</p>
    
    <div class='stats'>
        <div class='stat-card'>
            <h3>총 보안 이벤트</h3>
            <div style='font-size: 2em; font-weight: bold;'>{$stats['total_events']}</div>
        </div>
        <div class='stat-card'>
            <h3>고위험 이벤트</h3>
            <div style='font-size: 2em; font-weight: bold; color: #dc3545;'>{$stats['high_risk_events']}</div>
        </div>
    </div>
    
    <h2>⚠️ 감지된 위협 유형</h2>
    <ul>
";

foreach ($stats['threat_types'] as $threat => $count) {
    $level = $count > 10 ? 'high' : ($count > 5 ? 'medium' : 'low');
    $html .= "<li class='threat-level-$level'>$threat: $count회</li>";
}

$html .= "
    </ul>
    
    <h2>🌐 상위 의심 IP 주소</h2>
    <ul>
";

foreach (array_slice($stats['top_ips'], 0, 10, true) as $ip => $count) {
    $html .= "<li>$ip: $count회</li>";
}

$html .= "
    </ul>
</body>
</html>";

file_put_contents('security_dashboard.html', $html);
echo "보안 대시보드가 생성되었습니다: security_dashboard.html";
?>
```

## 📊 4단계: 사용량 모니터링

### 4.1 API 사용량 추적
```php
class UsageTracker {
    private $usageFile = 'usage_logs.txt';
    
    public function trackUsage($clientId, $endpoint, $tokens = 0, $cost = 0) {
        $usage = [
            'timestamp' => date('Y-m-d H:i:s'),
            'client_id' => $clientId,
            'endpoint' => $endpoint,
            'tokens' => $tokens,
            'cost' => $cost,
            'ip' => $_SERVER['REMOTE_ADDR'] ?? 'unknown'
        ];
        
        $logLine = json_encode($usage) . "\n";
        file_put_contents($this->usageFile, $logLine, FILE_APPEND | LOCK_EX);
    }
    
    public function getUsageStats($period = 'daily') {
        $lines = file($this->usageFile, FILE_IGNORE_NEW_LINES);
        
        $stats = [
            'total_requests' => 0,
            'total_tokens' => 0,
            'total_cost' => 0,
            'by_endpoint' => [],
            'by_client' => [],
            'by_hour' => []
        ];
        
        $cutoff = $this->getCutoffTime($period);
        
        foreach ($lines as $line) {
            $data = json_decode($line, true);
            if ($data && strtotime($data['timestamp']) > $cutoff) {
                $stats['total_requests']++;
                $stats['total_tokens'] += $data['tokens'];
                $stats['total_cost'] += $data['cost'];
                
                // 엔드포인트별 통계
                $endpoint = $data['endpoint'];
                if (!isset($stats['by_endpoint'][$endpoint])) {
                    $stats['by_endpoint'][$endpoint] = [
                        'requests' => 0,
                        'tokens' => 0,
                        'cost' => 0
                    ];
                }
                $stats['by_endpoint'][$endpoint]['requests']++;
                $stats['by_endpoint'][$endpoint]['tokens'] += $data['tokens'];
                $stats['by_endpoint'][$endpoint]['cost'] += $data['cost'];
                
                // 시간대별 통계
                $hour = date('H', strtotime($data['timestamp']));
                $stats['by_hour'][$hour] = ($stats['by_hour'][$hour] ?? 0) + 1;
            }
        }
        
        return $stats;
    }
    
    private function getCutoffTime($period) {
        switch ($period) {
            case 'hourly':
                return time() - 3600;
            case 'daily':
                return time() - (24 * 3600);
            case 'weekly':
                return time() - (7 * 24 * 3600);
            case 'monthly':
                return time() - (30 * 24 * 3600);
            default:
                return time() - (24 * 3600);
        }
    }
    
    public function generateUsageReport($period = 'daily') {
        $stats = $this->getUsageStats($period);
        
        $report = "
        === API 사용량 보고서 ($period) ===
        총 요청 수: {$stats['total_requests']}
        총 토큰 수: {$stats['total_tokens']}
        총 비용: \${$stats['total_cost']}
        
        엔드포인트별 사용량:
        ";
        
        foreach ($stats['by_endpoint'] as $endpoint => $data) {
            $report .= "- $endpoint: {$data['requests']}회, {$data['tokens']}토큰, \${$data['cost']}\n";
        }
        
        $report .= "\n시간대별 사용량:\n";
        ksort($stats['by_hour']);
        foreach ($stats['by_hour'] as $hour => $count) {
            $report .= "- {$hour}:00 - {$count}회\n";
        }
        
        return $report;
    }
}
```

### 4.2 비용 모니터링
```php
class CostMonitor {
    private $costRates = [
        'gpt-4o' => [
            'input' => 0.005, // $0.005 per 1K tokens
            'output' => 0.015  // $0.015 per 1K tokens
        ],
        'gpt-4' => [
            'input' => 0.03,
            'output' => 0.06
        ],
        'gpt-3.5-turbo' => [
            'input' => 0.001,
            'output' => 0.002
        ]
    ];
    
    public function calculateCost($model, $inputTokens, $outputTokens) {
        if (!isset($this->costRates[$model])) {
            return 0;
        }
        
        $rates = $this->costRates[$model];
        $inputCost = ($inputTokens / 1000) * $rates['input'];
        $outputCost = ($outputTokens / 1000) * $rates['output'];
        
        return $inputCost + $outputCost;
    }
    
    public function getDailyCost($date = null) {
        if (!$date) {
            $date = date('Y-m-d');
        }
        
        $lines = file('usage_logs.txt', FILE_IGNORE_NEW_LINES);
        $totalCost = 0;
        
        foreach ($lines as $line) {
            $data = json_decode($line, true);
            if ($data && strpos($data['timestamp'], $date) === 0) {
                $totalCost += $data['cost'];
            }
        }
        
        return $totalCost;
    }
    
    public function getMonthlyProjection() {
        $today = date('Y-m-d');
        $daysInMonth = date('t');
        $currentDay = date('j');
        
        $currentCost = $this->getDailyCost();
        $projectedCost = ($currentCost / $currentDay) * $daysInMonth;
        
        return [
            'current_cost' => $currentCost,
            'projected_cost' => $projectedCost,
            'days_remaining' => $daysInMonth - $currentDay
        ];
    }
}
```

## 🔔 5단계: 자동 알림 시스템

### 5.1 알림 설정
```php
class NotificationSystem {
    private $alerts = [];
    
    public function __construct() {
        $this->loadAlertConfig();
    }
    
    private function loadAlertConfig() {
        $this->alerts = [
            'high_error_rate' => [
                'threshold' => 0.05, // 5%
                'enabled' => true,
                'recipients' => ['admin@edgeenglish.net']
            ],
            'slow_response' => [
                'threshold' => 10.0, // 10초
                'enabled' => true,
                'recipients' => ['admin@edgeenglish.net']
            ],
            'high_cost' => [
                'threshold' => 100.0, // $100
                'enabled' => true,
                'recipients' => ['admin@edgeenglish.net', 'finance@edgeenglish.net']
            ],
            'security_threat' => [
                'threshold' => 50, // 위험 점수
                'enabled' => true,
                'recipients' => ['security@edgeenglish.net']
            ]
        ];
    }
    
    public function checkAlerts($metrics) {
        $triggeredAlerts = [];
        
        // 에러율 체크
        if (isset($metrics['error_rate']) && 
            $metrics['error_rate'] > $this->alerts['high_error_rate']['threshold']) {
            $triggeredAlerts[] = [
                'type' => 'high_error_rate',
                'value' => $metrics['error_rate'],
                'threshold' => $this->alerts['high_error_rate']['threshold']
            ];
        }
        
        // 응답 시간 체크
        if (isset($metrics['avg_response_time']) && 
            $metrics['avg_response_time'] > $this->alerts['slow_response']['threshold']) {
            $triggeredAlerts[] = [
                'type' => 'slow_response',
                'value' => $metrics['avg_response_time'],
                'threshold' => $this->alerts['slow_response']['threshold']
            ];
        }
        
        // 비용 체크
        if (isset($metrics['daily_cost']) && 
            $metrics['daily_cost'] > $this->alerts['high_cost']['threshold']) {
            $triggeredAlerts[] = [
                'type' => 'high_cost',
                'value' => $metrics['daily_cost'],
                'threshold' => $this->alerts['high_cost']['threshold']
            ];
        }
        
        foreach ($triggeredAlerts as $alert) {
            $this->sendAlert($alert);
        }
        
        return $triggeredAlerts;
    }
    
    private function sendAlert($alert) {
        $config = $this->alerts[$alert['type']];
        
        if (!$config['enabled']) {
            return;
        }
        
        $subject = $this->getAlertSubject($alert['type']);
        $message = $this->getAlertMessage($alert);
        
        foreach ($config['recipients'] as $recipient) {
            mail($recipient, $subject, $message);
        }
        
        // Slack 알림 (선택사항)
        $this->sendSlackAlert($alert);
    }
    
    private function getAlertSubject($type) {
        $subjects = [
            'high_error_rate' => '[경고] 높은 에러율 감지',
            'slow_response' => '[경고] 느린 응답 시간 감지',
            'high_cost' => '[경고] 높은 API 비용 감지',
            'security_threat' => '[보안] 보안 위협 감지'
        ];
        
        return $subjects[$type] ?? '[알림] 시스템 알림';
    }
    
    private function getAlertMessage($alert) {
        $message = "시스템 모니터링 알림\n\n";
        $message .= "알림 유형: {$alert['type']}\n";
        $message .= "현재 값: {$alert['value']}\n";
        $message .= "임계값: {$alert['threshold']}\n";
        $message .= "발생 시간: " . date('Y-m-d H:i:s') . "\n";
        $message .= "\n관리자 페이지에서 자세한 정보를 확인하세요.";
        
        return $message;
    }
    
    private function sendSlackAlert($alert) {
        $webhookUrl = 'YOUR_SLACK_WEBHOOK_URL';
        
        $payload = [
            'text' => "🚨 시스템 알림",
            'attachments' => [
                [
                    'color' => 'danger',
                    'fields' => [
                        [
                            'title' => '알림 유형',
                            'value' => $alert['type'],
                            'short' => true
                        ],
                        [
                            'title' => '현재 값',
                            'value' => $alert['value'],
                            'short' => true
                        ],
                        [
                            'title' => '임계값',
                            'value' => $alert['threshold'],
                            'short' => true
                        ]
                    ]
                ]
            ]
        ];
        
        $ch = curl_init($webhookUrl);
        curl_setopt($ch, CURLOPT_POSTFIELDS, json_encode($payload));
        curl_setopt($ch, CURLOPT_HTTPHEADER, ['Content-Type: application/json']);
        curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);
        curl_exec($ch);
        curl_close($ch);
    }
}
```

## 📋 모니터링 체크리스트

### 일일 모니터링
- [ ] API 응답 시간 확인 (목표: 5초 이내)
- [ ] 에러율 확인 (목표: 1% 이하)
- [ ] 요청 제한 초과 확인
- [ ] 보안 이벤트 확인
- [ ] 서버 리소스 사용량 확인

### 주간 모니터링
- [ ] 성능 트렌드 분석
- [ ] 사용량 패턴 분석
- [ ] 비용 분석 및 예측
- [ ] 보안 위협 분석
- [ ] 로그 파일 정리

### 월간 모니터링
- [ ] 전체 성능 보고서 작성
- [ ] 비용 최적화 방안 검토
- [ ] 보안 정책 업데이트
- [ ] 모니터링 시스템 개선
- [ ] 백업 및 복구 계획 검토

---

## 🎯 모니터링 성공 지표

### 목표 달성률
- **가용성**: 99.9% 이상 달성
- **응답 시간**: 평균 5초 이내 유지
- **성공률**: 99% 이상 유지
- **보안 사고**: 0건 유지
- **비용 효율성**: 예산 내 운영

### 개선 지표
- **문제 해결 시간**: 5분 이내
- **알림 정확도**: 95% 이상
- **모니터링 커버리지**: 100%
- **자동화율**: 90% 이상

**이 가이드를 따라하면 dothome.co.kr 백엔드 서버를 효과적으로 모니터링하고 관리할 수 있습니다!** 📊
