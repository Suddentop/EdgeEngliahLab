# 유형#03 페이지 분할 로직 문서

## 📋 개요

유형#03 (빈칸 단어 추론 문제)의 인쇄(정답) 페이지에서 동적 페이지 분할 로직에 대한 상세 문서입니다.

## 🎯 목적

A4 페이지의 제한된 공간 내에서 문제의 각 섹션을 효율적으로 배치하여, 내용이 잘리지 않도록 자동으로 페이지를 분할하는 로직을 구현합니다.

## 📐 A4 페이지 설정 (실제 A4 크기 기준, px 단위)

```typescript
const A4_CONFIG = {
  // 실제 A4 크기: 210mm × 297mm = 794px × 1123px (96 DPI)
  PAGE_WIDTH: 794,          // px (210mm * 3.78px/mm)
  PAGE_HEIGHT: 1123,        // px (297mm * 3.78px/mm)
  
  // 인쇄 여백 (실제 인쇄 시 표준 여백)
  TOP_MARGIN: 25,           // px (6.6mm)
  BOTTOM_MARGIN: 25,        // px (6.6mm)
  LEFT_MARGIN: 20,          // px (5.3mm)
  RIGHT_MARGIN: 20,         // px (5.3mm)
  
  // 헤더/푸터 영역
  HEADER_HEIGHT: 30,        // px (8mm)
  FOOTER_HEIGHT: 20,        // px (5.3mm)
  
  // 콘텐츠 영역 계산
  CONTENT_WIDTH: 754,       // px (794 - 20 - 20)
  CONTENT_HEIGHT: 1048,     // px (1123 - 25 - 25 - 30 - 20)
  
  // 섹션별 높이 설정
  INSTRUCTION_HEIGHT: 30,   // px
  INSTRUCTION_MARGIN: 11,   // px
  TRANSLATION_HEADER_HEIGHT: 30,  // px
  TRANSLATION_HEADER_MARGIN: 11,  // px
  OPTIONS_HEADER_HEIGHT: 30,      // px
  OPTIONS_HEADER_MARGIN: 11,      // px
};
```

## 🧮 컨테이너 높이 계산

### 1. 텍스트 높이 계산 함수 (실제 A4 크기 기준)

```typescript
function calculateContainerHeight(text: string, padding: number = 38, fontSize: number = 16, lineHeight: number = 1.7): number {
  // 실제 A4 콘텐츠 너비 사용 (754px - 좌우 패딩 40px = 714px)
  const availableWidthPx = A4_CONFIG.CONTENT_WIDTH - 40; // px
  const charWidthPx = fontSize * 0.55; // px 단위 문자 폭
  const charsPerLine = Math.floor(availableWidthPx / charWidthPx);
  const lines = Math.ceil(text.length / charsPerLine);
  return (lines * fontSize * lineHeight) + padding; // px 단위로 반환
}
```

### 2. 각 섹션별 높이 계산

#### A. 문제 제목 + 영어 본문 컨테이너
```typescript
const problemTitleHeight = A4_CONFIG.INSTRUCTION_HEIGHT + A4_CONFIG.INSTRUCTION_MARGIN; // 41px
const englishPassageHeight = calculateContainerHeight(quiz.blankedText, 38, 16, 1.7);
const sectionAHeight = problemTitleHeight + englishPassageHeight;
```

#### B. 4지선다 선택항목 컨테이너
```typescript
const optionsHeaderHeight = A4_CONFIG.OPTIONS_HEADER_HEIGHT + A4_CONFIG.OPTIONS_HEADER_MARGIN; // 41px
let optionsHeight = 0;
quiz.options.forEach(option => {
  optionsHeight += calculateContainerHeight(`${option} (정답)`, 11, 16, 1.3);
});
const sectionBHeight = optionsHeaderHeight + optionsHeight;
```

#### C. 본문해석 제목 + 한글 해석 컨테이너
```typescript
const translationHeaderHeight = A4_CONFIG.TRANSLATION_HEADER_HEIGHT + A4_CONFIG.TRANSLATION_HEADER_MARGIN; // 41px
const translationHeight = calculateContainerHeight(translatedText, 38, 16, 1.7);
const sectionCHeight = translationHeaderHeight + translationHeight;
```

## 📄 페이지 분할 로직

### 1. 이용 가능한 공간 계산 (실제 A4 크기 기준)

```typescript
// 실제 A4 콘텐츠 영역 높이 사용
const availableHeight = A4_CONFIG.CONTENT_HEIGHT; // 1048px

// 안전 마진 적용 (실제 A4 기준 적절한 여백)
const safetyMargin = 50; // px (실제 A4 기준 적절한 여백)
const effectiveAvailableHeight = availableHeight - safetyMargin;
// 1048 - 50 = 998px
```

### 2. 페이지 분할 조건

#### 케이스 1: A+B+C ≤ 998px
**→ 1페이지에 A, B, C 모두 포함**

```typescript
if (totalHeight <= effectiveAvailableHeight) {
  setPageLayoutInfo({
    needsSecondPage: false,
    needsThirdPage: false,
    page1Content: 'A+B+C',
    page2Content: '',
    page3Content: ''
  });
}
```

#### 케이스 2: A+B+C > 998px, A+B ≤ 998px
**→ 1페이지에 A+B 포함, 2페이지에 C 포함**

```typescript
else if (sectionAHeight + sectionBHeight <= effectiveAvailableHeight) {
  if (sectionCHeight <= effectiveAvailableHeight) {
    // C가 한 페이지에 들어갈 수 있음
    setPageLayoutInfo({
      needsSecondPage: true,
      needsThirdPage: false,
      page1Content: 'A+B',
      page2Content: 'C',
      page3Content: ''
    });
  } else {
    // C가 한 페이지에 들어가지 않음 → 2페이지에 C 일부, 3페이지에 C 나머지
    setPageLayoutInfo({
      needsSecondPage: true,
      needsThirdPage: true,
      page1Content: 'A+B',
      page2Content: 'C-part1',
      page3Content: 'C-part2'
    });
  }
}
```

#### 케이스 3: A+B+C > 998px, A+B > 998px, A ≤ 998px
**→ 1페이지에 A 포함, 2페이지에 B+C 포함**

```typescript
else if (sectionAHeight <= effectiveAvailableHeight) {
  if (sectionBHeight + sectionCHeight <= effectiveAvailableHeight) {
    // B+C가 한 페이지에 들어갈 수 있음
    setPageLayoutInfo({
      needsSecondPage: true,
      needsThirdPage: false,
      page1Content: 'A',
      page2Content: 'B+C',
      page3Content: ''
    });
  } else {
    // B+C가 한 페이지에 들어가지 않음 → 2페이지에 B, 3페이지에 C
    setPageLayoutInfo({
      needsSecondPage: true,
      needsThirdPage: true,
      page1Content: 'A',
      page2Content: 'B',
      page3Content: 'C'
    });
  }
}
```

#### 케이스 4: A+B+C > 998px, A+B > 998px, A > 998px
**→ 1페이지에 A 포함, 2페이지에 B 포함, 3페이지에 C 포함**

```typescript
else {
  setPageLayoutInfo({
    needsSecondPage: true,
    needsThirdPage: true,
    page1Content: 'A',
    page2Content: 'B',
    page3Content: 'C'
  });
}
```

## 🎨 렌더링 로직

### 1. 조건부 렌더링

각 페이지에서 해당하는 섹션만 렌더링:

```typescript
{/* 1페이지 */}
{(pageLayoutInfo.page1Content.includes('A') || pageLayoutInfo.page1Content === 'A') && (
  // A. 문제 제목 + 영어 본문 컨테이너
)}

{(pageLayoutInfo.page1Content.includes('B') || pageLayoutInfo.page1Content === 'B') && (
  // B. 4지선다 선택항목 컨테이너
)}

{(pageLayoutInfo.page1Content.includes('C') || pageLayoutInfo.page1Content === 'C') && (
  // C. 본문해석 제목 + 한글 해석 컨테이너
)}
```

### 2. A4 템플릿 사용

각 페이지는 `a4-page-template` 클래스를 사용하여 A4 크기로 렌더링:

```typescript
<div className="a4-page-template">
  <div className="a4-page-header">
    <PrintHeaderWork01 />
  </div>
  <div className="a4-page-content">
    <div className="quiz-content">
      {/* 해당 페이지의 컨텐츠 */}
    </div>
  </div>
</div>
```

## 🔍 디버깅 로그

페이지 분할 계산 과정을 추적하기 위한 로그:

```typescript
console.log('📏 유형#03 동적 페이지 분할 계산:', {
  availableHeight: availableHeight.toFixed(2) + 'px',
  sectionAHeight: sectionAHeight.toFixed(2) + 'px',
  sectionBHeight: sectionBHeight.toFixed(2) + 'px',
  sectionCHeight: sectionCHeight.toFixed(2) + 'px',
  totalHeight: (sectionAHeight + sectionBHeight + sectionCHeight).toFixed(2) + 'px',
  effectiveAvailableHeight: effectiveAvailableHeight.toFixed(2) + 'px',
  quizTextLength: quiz.blankedText.length,
  translationTextLength: translatedText.length
});

// 실제 A4 크기 기준 검증
console.log('🔍 실제 A4 크기 기준 계산:', {
  A4_SIZE: '210mm × 297mm = 794px × 1123px (96 DPI)',
  CONTENT_AREA: A4_CONFIG.CONTENT_WIDTH + 'px × ' + A4_CONFIG.CONTENT_HEIGHT + 'px',
  TOP_MARGIN: A4_CONFIG.TOP_MARGIN + 'px',
  BOTTOM_MARGIN: A4_CONFIG.BOTTOM_MARGIN + 'px',
  LEFT_MARGIN: A4_CONFIG.LEFT_MARGIN + 'px',
  RIGHT_MARGIN: A4_CONFIG.RIGHT_MARGIN + 'px',
  HEADER_HEIGHT: A4_CONFIG.HEADER_HEIGHT + 'px',
  FOOTER_HEIGHT: A4_CONFIG.FOOTER_HEIGHT + 'px',
  availableHeight: availableHeight + 'px',
  safetyMargin: safetyMargin + 'px',
  effectiveAvailableHeight: effectiveAvailableHeight + 'px'
});
```

## 📊 예시 시나리오

### 시나리오 1: 짧은 문제
- A: 200px, B: 150px, C: 300px
- 총합: 650px ≤ 998px
- **결과**: 1페이지에 모든 내용 포함

### 시나리오 2: 중간 길이 문제
- A: 300px, B: 200px, C: 600px
- 총합: 1100px > 998px
- A+B: 500px ≤ 998px
- **결과**: 1페이지에 A+B, 2페이지에 C

### 시나리오 3: 긴 문제
- A: 400px, B: 300px, C: 500px
- 총합: 1200px > 998px
- A+B: 700px ≤ 998px
- **결과**: 1페이지에 A+B, 2페이지에 C

### 시나리오 4: 매우 긴 문제
- A: 500px, B: 400px, C: 600px
- 총합: 1500px > 998px
- A+B: 900px ≤ 998px
- **결과**: 1페이지에 A+B, 2페이지에 C

### 시나리오 5: 극도로 긴 문제
- A: 1200px, B: 300px, C: 400px
- 총합: 1900px > 998px
- A+B: 1500px > 998px
- A: 1200px > 998px
- **결과**: 1페이지에 A, 2페이지에 B, 3페이지에 C

## ⚠️ 주의사항

1. **단위 통일**: 모든 계산은 px 단위로 통일
2. **실제 A4 크기**: 표준 A4 크기 (210mm × 297mm) 기준으로 계산
3. **안전 마진**: 50px의 안전 마진 적용 (실제 A4 기준 적절한 여백)
4. **텍스트 길이**: 매우 긴 텍스트의 경우 정확한 높이 계산 필요
5. **폰트 크기**: 16px 기준으로 계산 (인쇄 시 1rem = 16px)
6. **줄 간격**: lineHeight 1.7 적용
7. **브라우저 독립성**: 실제 A4 크기 기준으로 브라우저에 관계없이 일관된 결과

## 🔧 문제 해결

### 이전 문제점
- cm와 px 단위가 섞여서 계산 오류 발생
- 높이 값이 비정상적으로 커져서 3페이지로 분할되는 문제
- 브라우저별 A4 크기 차이로 인한 불일치

### 해결 방법
- 모든 계산을 px 단위로 통일
- 실제 A4 표준 크기 (210mm × 297mm) 기준으로 계산
- 정확한 단위 변환 공식 적용 (1mm = 3.78px, 96 DPI)
- 안전 마진을 실제 A4 기준으로 조정 (50px)
- 브라우저 독립적인 계산 방식 적용

## 📝 업데이트 이력

- **2025-09-28**: 초기 문서 작성
- **2025-09-28**: px 단위 통일로 계산 오류 수정
- **2025-09-28**: 상세한 로직 설명 및 예시 추가
- **2025-09-28**: 실제 A4 크기 기준으로 계산 방식 개선
- **2025-09-28**: 브라우저 독립적인 페이지 분할 로직 구현
